(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3663:(e,t,a)=>{Promise.resolve().then(a.bind(a,6367))},6367:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var l=a(5155),r=a(6072),n=a(2115),s=a(6366);let o=e=>{let{progress:t}=e,a=Math.min(100,Math.max(0,t));return(0,l.jsx)("div",{className:"absolute w-xl bg-[#00000] bottom-0 left-0 top-0",children:(0,l.jsx)("div",{className:"bg-[#8e8b8f11] h-full transition-all duration-500 ease-in-out",style:{width:"".concat(a,"%")}})})},i=new s.aL({appName:"TruckersFM Stream Overlay",appVersion:"0.1.0",appContactInfo:"contact@tumppi066.fi"});function c(){let[e,t]=(0,n.useState)(""),[a,s]=(0,n.useState)(""),[c,d]=(0,n.useState)(null),{data:u,error:m}=(0,r.Ay)("https://radiocloud.pro/api/public/v1/song/current",e=>fetch(e).then(e=>e.json()),{refreshInterval:1e4}),{data:h,error:g}=(0,r.Ay)("https://radiocloud.pro/api/public/v1/presenter/live",e=>fetch(e).then(e=>e.json()),{refreshInterval:1e4}),p=null==u?void 0:u.data.artist,f=null==u?void 0:u.data.title,x=null==u?void 0:u.data.album_art,b=null==u?void 0:u.data.played_at,v=null!==c&&c.getTime()+10<new Date().getTime(),w=null==h?void 0:h.data.description,N=null==h?void 0:h.data.user.name,j=null==h?void 0:h.data.image,k=e=>{let t=new Date().getTime()-e.getTime(),a=Math.floor(t/1e3/60)%60,l=Math.floor(t/1e3)%60,r=a.toString().padStart(2,"0"),n=l.toString().padStart(2,"0");return"".concat(r,":").concat(n)},S=()=>v?j||"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/TruckersFM_New_Logo.png/960px-TruckersFM_New_Logo.png":x;return((0,n.useEffect)(()=>{a&&i.search("recording",{query:'query=artist:"'+p+'" AND recording:"'+f+'"'}).then(e=>{let t=e.recordings;0===t.length&&d(null);for(let e=0;e<t.length;e++){let a=t[e];if(a.disambiguation||a.video||a.title!==f||!a.length||a.length<2e4)continue;let l=a.length,r=new Date(1e3*b);r.setSeconds(r.getSeconds()+l/1e3),d(r);return}d(null)}).catch(e=>{d(null),console.error(e)})},[a]),(0,n.useEffect)(()=>{u&&s(u.data.link)},[u]),(0,n.useEffect)(()=>{if(!b)return;let e=setInterval(()=>{t(k(new Date(1e3*b)))},1e3);return()=>clearInterval(e)},[b]),m|g)?(0,l.jsx)("div",{children:"TruckersFM API failed to return data"}):(0,l.jsxs)("div",{className:"border border-[#191919] flex rounded-xl w-xl h-40.5 font-geist bg-[#131313] relative p-4 overflow-hidden",children:[x&&(0,l.jsx)("div",{className:"w-32 h-32 rounded-md border z-10",style:{backgroundImage:"url(".concat(S(),")"),backgroundSize:"cover",backgroundPosition:"center"}}),v?(0,l.jsxs)("div",{className:"flex flex-col pl-4 z-10",children:[(0,l.jsx)("p",{className:"text-xl font-semibold",children:w}),(0,l.jsxs)("p",{className:"text-sm font-semibold",children:["by ",N]}),(0,l.jsx)("p",{className:"text-sm text-[#8e8b8f] absolute bottom-4",children:"Presenting now at TruckersFM"})]}):(0,l.jsxs)("div",{className:"flex flex-col pl-4 z-10",children:[(0,l.jsx)("p",{className:"text-xl font-semibold",children:f}),(0,l.jsxs)("p",{className:"text-sm font-semibold",children:["by ",p]}),c&&(0,l.jsxs)("p",{className:"text-sm",children:[e," / ",((e,t)=>{let a=t.getTime()-e.getTime(),l=Math.floor(a/1e3/60)%60,r=Math.floor(a/1e3)%60,n=l.toString().padStart(2,"0"),s=r.toString().padStart(2,"0");return"".concat(n,":").concat(s)})(new Date(1e3*b),c)]}),!c&&(0,l.jsx)("p",{className:"text-sm",children:e}),(0,l.jsx)("p",{className:"text-sm text-[#8e8b8f] absolute bottom-4",children:"Playing now on TruckersFM"})]}),x&&(0,l.jsx)("div",{className:"absolute w-full h-full rounded-lg -my-4 -mx-4",style:{backgroundImage:"url(".concat(S(),")"),backgroundSize:"cover",backgroundPosition:"center",filter:"blur(20px) brightness(0.3)"}}),c&&(0,l.jsx)(o,{progress:Math.floor((new Date().getTime()-new Date(1e3*b).getTime())/(c.getTime()-new Date(1e3*b).getTime())*100)})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[625,441,684,358],()=>t(3663)),_N_E=e.O()}]);