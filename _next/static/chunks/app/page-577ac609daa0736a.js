(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{671:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>g});var a=l(5155),s=l(6072),r=l(2115),o=l(6366);let n=e=>{let{progress:t}=e,l=Math.min(100,Math.max(0,t));return(0,a.jsx)("div",{className:"absolute w-full bottom-0 left-0 top-0",children:(0,a.jsx)("div",{className:"bg-[#8e8b8f15] h-full transition-all duration-500 ease-in-out",style:{width:"".concat(l,"%")}})})};var i=l(6766);let c=e=>{let t=new Date().getTime()-e.getTime(),l=Math.floor(t/1e3/60)%60,a=Math.floor(t/1e3)%60,s=l.toString().padStart(2,"0"),r=a.toString().padStart(2,"0");return"".concat(s,":").concat(r)},d=(e,t)=>{let l=t.getTime()-e.getTime(),a=Math.floor(l/1e3/60)%60,s=Math.floor(l/1e3)%60,r=a.toString().padStart(2,"0"),o=s.toString().padStart(2,"0");return"".concat(r,":").concat(o)},u=(e,t)=>{let l=e.toLowerCase().split(/\s+/),a=t.toLowerCase().split(/\s+/),s=0;for(let e of l)a.includes(e)&&s++;return s/Math.max(l.length,a.length)},p=new o.aL({appName:"TruckersFM Stream Overlay",appVersion:"0.1.0",appContactInfo:"contact@tumppi066.fi"});function g(){let[e,t]=(0,r.useState)(""),[l,o]=(0,r.useState)(""),[g,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!window)return;let e=new URLSearchParams(window.location.search).get("scale")||"1";document.documentElement.style.setProperty("--scale",e)},[window]);let{data:m,error:f}=(0,s.Ay)("https://radiocloud.pro/api/public/v1/song/current",e=>fetch(e).then(e=>e.json()),{refreshInterval:1e4}),{data:w,error:v}=(0,s.Ay)("https://radiocloud.pro/api/public/v1/presenter/live",e=>fetch(e).then(e=>e.json()),{refreshInterval:3e4}),b=null==m?void 0:m.data.artist,x=null==m?void 0:m.data.title,k=null==m?void 0:m.data.album_art,N=null==m?void 0:m.data.played_at,y=null==w?void 0:w.data.description,S=null==w?void 0:w.data.user.name,j=null==w?void 0:w.data.image,T=null!==g&&g.getTime()+10<new Date().getTime(),_=()=>T?j||"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/TruckersFM_New_Logo.png/960px-TruckersFM_New_Logo.png":k,M=e=>!!(!e||"clean"==e||"explicit"==e||e.includes("Dolby Atmos")||e.includes("album version")||e.includes("Eurovision"));return((0,r.useEffect)(()=>{if(!l)return;let e=x.split(" (")[0],t=b.split(" & ")[0].split(" / ")[0].split(" and ")[0].split(" x ")[0].split(" vs. ")[0].split(",")[0],a='query=artist:"'.concat(t,'" AND recording:"').concat(e,'"');p.search("recording",{query:a}).then(t=>{let l=t.recordings;0===l.length&&h(null),console.log("Found "+l.length+" recordings for "+x+" by "+b+" ("+a+")");for(let t=0;t<l.length;t++){let a=l[t];if(!M(a.disambiguation)||(console.log(t+" passed disambiguation check"),a.video)||(console.log(t+" passed video check"),.75>u(a.title.replaceAll("'","’").toLowerCase(),e.replaceAll("'","’").toLowerCase()))||(console.log(t+" passed similarity check"),a.title.replaceAll("'","’").toLowerCase()!=e.replaceAll("'","’").toLowerCase())||(console.log(t+" passed title check"),!a.length)||(console.log(t+" passed length check"),a.length<2e4))continue;console.log(t+" passed 20s check");let s=a.length,r=new Date(1e3*N);r.setSeconds(r.getSeconds()+s/1e3),h(r),console.log("Found end time: "+r.toString()+" for "+x+" by "+b);return}h(null)}).catch(e=>{h(null),console.error(e)})},[l]),(0,r.useEffect)(()=>{m&&o(m.data.link)},[m]),(0,r.useEffect)(()=>{if(!N)return;let e=setInterval(()=>{t(c(new Date(1e3*N)))},1e3);return()=>clearInterval(e)},[N]),f|v)?(0,a.jsx)("div",{children:"TruckersFM API failed to return data"}):(0,a.jsxs)("div",{className:"border border-[#191919] flex rounded-xl w-xl font-geist bg-[#131313] relative p-4 overflow-hidden",style:{scale:"var(--scale, 1)"},children:[k&&(0,a.jsx)("div",{className:"min-w-32 min-h-32 rounded-md border z-10",style:{backgroundImage:"url(".concat(_(),")"),backgroundSize:"cover",backgroundPosition:"center"}}),(0,a.jsxs)("div",{className:"flex flex-col pl-4 z-10 w-full",children:[(0,a.jsxs)("div",{className:"w-full flex justify-between items-start pr-2",children:[(0,a.jsx)("p",{className:"text-xl",children:T?y:x}),(0,a.jsx)(i.default,{src:"/tfm.svg",alt:"",width:74,height:1,className:"pt-2 hover:cursor-pointer",onClick:()=>{window.open("https://truckers.fm/","_blank")}})]}),(0,a.jsxs)("p",{className:"text-sm",children:["by ",T?S:b]}),g&&!T?(0,a.jsxs)("p",{className:"text-sm",children:[e," / ",d(new Date(1e3*N),g)]}):!g&&(0,a.jsx)("p",{className:"text-sm",children:e})]}),k&&(0,a.jsx)("div",{className:"absolute w-full h-full rounded-lg -my-4 -mx-4",style:{backgroundImage:"url(".concat(_(),")"),backgroundSize:"cover",backgroundPosition:"center",filter:"blur(20px) brightness(0.3)"}}),g&&!T&&(0,a.jsx)(n,{progress:Math.floor((new Date().getTime()-new Date(1e3*N).getTime())/(g.getTime()-new Date(1e3*N).getTime())*100)})]})}},3663:(e,t,l)=>{Promise.resolve().then(l.bind(l,671))}},e=>{var t=t=>e(e.s=t);e.O(0,[762,441,684,358],()=>t(3663)),_N_E=e.O()}]);