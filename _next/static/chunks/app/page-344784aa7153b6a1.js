(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{392:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>d});var r=l(5155),a=l(6072),n=l(2115),s=l(6366);function o(e,t,l){return e?t||"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/TruckersFM_New_Logo.png/960px-TruckersFM_New_Logo.png":l}let i=e=>{let{progress:t}=e,l=Math.min(100,Math.max(0,t));return(0,r.jsx)("div",{className:"absolute w-full bottom-0 left-0 top-0",children:(0,r.jsx)("div",{className:"bg-[#8e8b8f15] h-full transition-all duration-500 ease-in-out",style:{width:"".concat(l,"%")}})})};var c=l(6766);let u=new s.aL({appName:"TruckersFM Stream Overlay",appVersion:"0.1.0",appContactInfo:"contact@tumppi066.fi"});function d(){let[e,t]=(0,n.useState)(""),[l,s]=(0,n.useState)(""),[d,p]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!window)return;let e=new URLSearchParams(window.location.search).get("scale")||"1";document.documentElement.style.setProperty("--scale",e)},[window]);let{data:m,error:f}=(0,a.Ay)("https://radiocloud.pro/api/public/v1/song/current",e=>fetch(e).then(e=>e.json()),{refreshInterval:1e4}),{data:h,error:g}=(0,a.Ay)("https://radiocloud.pro/api/public/v1/presenter/live",e=>fetch(e).then(e=>e.json()),{refreshInterval:3e4}),v=null==m?void 0:m.data.artist,w=null==m?void 0:m.data.title,x=null==m?void 0:m.data.album_art,b=null==m?void 0:m.data.played_at,k=b?new Date(1e3*b):new Date,N=null==h?void 0:h.data.description,j=null==h?void 0:h.data.user.name,S=null==h?void 0:h.data.image,y=null!==d&&d.getTime()+10<new Date().getTime();return((0,n.useEffect)(()=>{if(!l)return;let e=w.split(" (")[0],t=v.split(" & ")[0].split(" / ")[0].split(" and ")[0].split(" x ")[0].split(" vs. ")[0].split(",")[0],r='query=artist:"'.concat(t,'" AND recording:"').concat(e,'"');u.search("recording",{query:r}).then(t=>{let l=t.recordings;0===l.length&&p(null);for(let t=0;t<l.length;t++){let r=l[t];if(!function(e,t){var l;return!(!(!(l=e.disambiguation)||"clean"==l||"explicit"==l||l.includes("Dolby Atmos")||l.includes("album version")||l.includes("Eurovision"))||e.video||.75>function(e,t){let l=e.toLowerCase().split(/\s+/),r=t.toLowerCase().split(/\s+/),a=0;for(let e of l)r.includes(e)&&a++;return a/Math.max(l.length,r.length)}(e.title.replaceAll("'","’").toLowerCase(),t.replaceAll("'","’").toLowerCase()))&&e.title.replaceAll("'","’").toLowerCase()==t.replaceAll("'","’").toLowerCase()&&!!e.length&&!(e.length<2e4)}(r,e))continue;let a=r.length;k.setSeconds(k.getSeconds()+a/1e3),p(k);return}p(null)}).catch(e=>{p(null),console.error(e)})},[l]),(0,n.useEffect)(()=>{m&&s(m.data.link)},[m]),(0,n.useEffect)(()=>{if(!b)return;let e=setInterval(()=>{t(function(e){let t=new Date().getTime()-e.getTime(),l=Math.floor(t/1e3/60)%60,r=Math.floor(t/1e3)%60,a=l.toString().padStart(2,"0"),n=r.toString().padStart(2,"0");return"".concat(a,":").concat(n)}(k))},1e3);return()=>clearInterval(e)},[b]),f||g)?(0,r.jsx)("div",{children:"TruckersFM API failed to return data"}):(0,r.jsxs)("div",{className:"border border-[#191919] flex rounded-xl w-xl font-geist bg-[#131313] relative p-4 overflow-hidden",style:{scale:"var(--scale, 1)"},children:[x&&(0,r.jsx)("div",{className:"min-w-32 min-h-32 rounded-md border z-10",style:{backgroundImage:"url(".concat(o(y,S,x),")"),backgroundSize:"cover",backgroundPosition:"center"}}),(0,r.jsxs)("div",{className:"flex flex-col pl-4 z-10 w-full",children:[(0,r.jsxs)("div",{className:"w-full flex justify-between items-start pr-2",children:[(0,r.jsx)("p",{className:"text-xl",children:y?N:w}),(0,r.jsx)(c.default,{src:"/tfm.svg",alt:"",width:74,height:1,className:"pt-2 hover:cursor-pointer",onClick:()=>{window.open("https://truckers.fm/","_blank")}})]}),(0,r.jsxs)("p",{className:"text-sm",children:["by ",y?j:v]}),d&&!y?(0,r.jsxs)("p",{className:"text-sm",children:[e," / ",function(e,t){let l=t.getTime()-e.getTime(),r=Math.floor(l/1e3/60)%60,a=Math.floor(l/1e3)%60,n=r.toString().padStart(2,"0"),s=a.toString().padStart(2,"0");return"".concat(n,":").concat(s)}(k,d)]}):null,d||y?null:(0,r.jsx)("p",{className:"text-sm",children:e})]}),x&&(0,r.jsx)("div",{className:"absolute w-full h-full rounded-lg -my-4 -mx-4",style:{backgroundImage:"url(".concat(o(y,S,x),")"),backgroundSize:"cover",backgroundPosition:"center",filter:"blur(20px) brightness(0.3)"}}),d&&!y&&(0,r.jsx)(i,{progress:(new Date().getTime()-k.getTime())/(d.getTime()-k.getTime())*100})]})}},3663:(e,t,l)=>{Promise.resolve().then(l.bind(l,392))}},e=>{var t=t=>e(e.s=t);e.O(0,[762,441,684,358],()=>t(3663)),_N_E=e.O()}]);