(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{671:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>d});var a=l(5155),s=l(6072),r=l(2115),n=l(6366);let o=e=>{let{progress:t}=e,l=Math.min(100,Math.max(0,t));return(0,a.jsx)("div",{className:"absolute w-xl bg-[#00000] bottom-0 left-0 top-0",children:(0,a.jsx)("div",{className:"bg-[#8e8b8f15] h-full transition-all duration-500 ease-in-out",style:{width:"".concat(l,"%")}})})};var i=l(6766);let c=new n.aL({appName:"TruckersFM Stream Overlay",appVersion:"0.1.0",appContactInfo:"contact@tumppi066.fi"});function d(){let[e,t]=(0,r.useState)(""),[l,n]=(0,r.useState)(""),[d,u]=(0,r.useState)(null),{data:g,error:h}=(0,s.Ay)("https://radiocloud.pro/api/public/v1/song/current",e=>fetch(e).then(e=>e.json()),{refreshInterval:1e4}),{data:m,error:p}=(0,s.Ay)("https://radiocloud.pro/api/public/v1/presenter/live",e=>fetch(e).then(e=>e.json()),{refreshInterval:3e4}),f=null==g?void 0:g.data.artist,x=null==g?void 0:g.data.title,b=null==g?void 0:g.data.album_art,v=null==g?void 0:g.data.played_at,w=null!==d&&d.getTime()+10<new Date().getTime(),N=null==m?void 0:m.data.description,j=null==m?void 0:m.data.user.name,k=null==m?void 0:m.data.image,S=e=>{let t=new Date().getTime()-e.getTime(),l=Math.floor(t/1e3/60)%60,a=Math.floor(t/1e3)%60,s=l.toString().padStart(2,"0"),r=a.toString().padStart(2,"0");return"".concat(s,":").concat(r)},y=()=>w?k||"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/TruckersFM_New_Logo.png/960px-TruckersFM_New_Logo.png":b,T=e=>!!(!e||"clean"==e||"explicit"==e||e.includes("Dolby Atmos"));return((0,r.useEffect)(()=>{if(!l)return;let e=x,t=x.indexOf(" (feat. ");-1!==t&&(e=x.substring(0,t));let a='query=artist:"'+f+'" AND recording:"'+e+'"';c.search("recording",{query:a}).then(t=>{let l=t.recordings;0===l.length&&u(null),console.log("Found "+l.length+" recordings for "+x+" by "+f);for(let t=0;t<l.length;t++){let a=l[t];if(!T(a.disambiguation)||(console.log(t+" passed disambiguation check"),a.video)||(console.log(t+" passed video check"),a.title.replaceAll("'","’").toLowerCase()!=e.replaceAll("'","’").toLowerCase())||(console.log(t+" passed title check"),!a.length)||(console.log(t+" passed length check"),a.length<2e4))continue;console.log(t+" passed 20s check");let s=a.length,r=new Date(1e3*v);r.setSeconds(r.getSeconds()+s/1e3),u(r),console.log("Found end time: "+r.toString()+" for "+x+" by "+f);return}u(null)}).catch(e=>{u(null),console.error(e)})},[l]),(0,r.useEffect)(()=>{g&&n(g.data.link)},[g]),(0,r.useEffect)(()=>{if(!v)return;let e=setInterval(()=>{t(S(new Date(1e3*v)))},1e3);return()=>clearInterval(e)},[v]),h|p)?(0,a.jsx)("div",{children:"TruckersFM API failed to return data"}):(0,a.jsxs)("div",{className:"border border-[#191919] flex rounded-xl w-xl h-40.5 font-geist bg-[#131313] relative p-4 overflow-hidden",children:[b&&(0,a.jsx)("div",{className:"w-32 h-32 rounded-md border z-10",style:{backgroundImage:"url(".concat(y(),")"),backgroundSize:"cover",backgroundPosition:"center"}}),w?(0,a.jsxs)("div",{className:"flex flex-col pl-4 z-10",children:[(0,a.jsx)("p",{className:"text-xl",children:N}),(0,a.jsxs)("p",{className:"text-sm",children:["by ",j]}),(0,a.jsxs)("div",{className:"absolute bottom-4 flex gap-[5px]",children:[(0,a.jsx)("p",{className:"text-sm text-[#8e8b8f]",children:"Presenting now at"}),(0,a.jsx)(i.default,{src:"/tfm.svg",alt:"",width:72,height:1})]})]}):(0,a.jsxs)("div",{className:"flex flex-col pl-4 z-10",children:[(0,a.jsx)("p",{className:"text-xl",children:x}),(0,a.jsxs)("p",{className:"text-sm",children:["by ",f]}),d&&(0,a.jsxs)("p",{className:"text-sm",children:[e," / ",((e,t)=>{let l=t.getTime()-e.getTime(),a=Math.floor(l/1e3/60)%60,s=Math.floor(l/1e3)%60,r=a.toString().padStart(2,"0"),n=s.toString().padStart(2,"0");return"".concat(r,":").concat(n)})(new Date(1e3*v),d)]}),!d&&(0,a.jsx)("p",{className:"text-sm",children:e}),(0,a.jsxs)("div",{className:"absolute bottom-4 flex gap-[5px]",children:[(0,a.jsx)("p",{className:"text-sm text-[#8e8b8f]",children:"Playing now on"}),(0,a.jsx)(i.default,{src:"/tfm.svg",alt:"",width:72,height:1})]})]}),b&&(0,a.jsx)("div",{className:"absolute w-full h-full rounded-lg -my-4 -mx-4",style:{backgroundImage:"url(".concat(y(),")"),backgroundSize:"cover",backgroundPosition:"center",filter:"blur(20px) brightness(0.3)"}}),d&&!w&&(0,a.jsx)(o,{progress:Math.floor((new Date().getTime()-new Date(1e3*v).getTime())/(d.getTime()-new Date(1e3*v).getTime())*100)})]})}},3663:(e,t,l)=>{Promise.resolve().then(l.bind(l,671))}},e=>{var t=t=>e(e.s=t);e.O(0,[762,441,684,358],()=>t(3663)),_N_E=e.O()}]);