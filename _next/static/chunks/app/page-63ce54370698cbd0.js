(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3663:(e,t,l)=>{Promise.resolve().then(l.bind(l,6367))},6367:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>c});var a=l(5155),o=l(6072),s=l(2115),n=l(6366);let r=e=>{let{progress:t}=e,l=Math.min(100,Math.max(0,t));return(0,a.jsx)("div",{className:"absolute w-xl bg-[#00000] bottom-0 left-0 top-0",children:(0,a.jsx)("div",{className:"bg-[#8e8b8f11] h-full transition-all duration-500 ease-in-out",style:{width:"".concat(l,"%")}})})},i=new n.aL({appName:"TruckersFM Stream Overlay",appVersion:"0.1.0",appContactInfo:"contact@tumppi066.fi"});function c(){let[e,t]=(0,s.useState)(""),[l,n]=(0,s.useState)(""),[c,d]=(0,s.useState)(null),{data:u,error:g}=(0,o.Ay)("https://radiocloud.pro/api/public/v1/song/current",e=>fetch(e).then(e=>e.json()),{refreshInterval:1e4}),{data:m,error:h}=(0,o.Ay)("https://radiocloud.pro/api/public/v1/presenter/live",e=>fetch(e).then(e=>e.json()),{refreshInterval:3e4}),p=null==u?void 0:u.data.artist,f=null==u?void 0:u.data.title,b=null==u?void 0:u.data.album_art,x=null==u?void 0:u.data.played_at,v=null!==c&&c.getTime()+10<new Date().getTime(),k=null==m?void 0:m.data.description,w=null==m?void 0:m.data.user.name,N=null==m?void 0:m.data.image,j=e=>{let t=new Date().getTime()-e.getTime(),l=Math.floor(t/1e3/60)%60,a=Math.floor(t/1e3)%60,o=l.toString().padStart(2,"0"),s=a.toString().padStart(2,"0");return"".concat(o,":").concat(s)},S=()=>v?N||"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/TruckersFM_New_Logo.png/960px-TruckersFM_New_Logo.png":b,T=e=>!!(!e||"clean"==e||"explicit"==e||e.includes("Dolby Atmos"));return((0,s.useEffect)(()=>{if(!l)return;let e=f,t=f.indexOf(" (feat. ");-1!==t&&(e=f.substring(0,t));let a='query=artist:"'+p+'" AND recording:"'+e+'"';i.search("recording",{query:a}).then(t=>{let l=t.recordings;0===l.length&&d(null),console.log("Found "+l.length+" recordings for "+f+" by "+p);for(let t=0;t<l.length;t++){let a=l[t];if(!T(a.disambiguation)||(console.log(t+" passed disambiguation check"),a.video)||(console.log(t+" passed video check"),a.title.replaceAll("'","’")!=e.replaceAll("'","’"))||(console.log(t+" passed title check"),!a.length)||(console.log(t+" passed length check"),a.length<2e4))continue;console.log(t+" passed 20s check");let o=a.length,s=new Date(1e3*x);s.setSeconds(s.getSeconds()+o/1e3),d(s),console.log("Found end time: "+s.toString()+" for "+f+" by "+p);return}d(null)}).catch(e=>{d(null),console.error(e)})},[l]),(0,s.useEffect)(()=>{u&&n(u.data.link)},[u]),(0,s.useEffect)(()=>{if(!x)return;let e=setInterval(()=>{t(j(new Date(1e3*x)))},1e3);return()=>clearInterval(e)},[x]),g|h)?(0,a.jsx)("div",{children:"TruckersFM API failed to return data"}):(0,a.jsxs)("div",{className:"border border-[#191919] flex rounded-xl w-xl h-40.5 font-geist bg-[#131313] relative p-4 overflow-hidden",children:[b&&(0,a.jsx)("div",{className:"w-32 h-32 rounded-md border z-10",style:{backgroundImage:"url(".concat(S(),")"),backgroundSize:"cover",backgroundPosition:"center"}}),v?(0,a.jsxs)("div",{className:"flex flex-col pl-4 z-10",children:[(0,a.jsx)("p",{className:"text-xl font-semibold",children:k}),(0,a.jsxs)("p",{className:"text-sm font-semibold",children:["by ",w]}),(0,a.jsx)("p",{className:"text-sm text-[#8e8b8f] absolute bottom-4",children:"Presenting now at TruckersFM"})]}):(0,a.jsxs)("div",{className:"flex flex-col pl-4 z-10",children:[(0,a.jsx)("p",{className:"text-xl font-semibold",children:f}),(0,a.jsxs)("p",{className:"text-sm font-semibold",children:["by ",p]}),c&&(0,a.jsxs)("p",{className:"text-sm",children:[e," / ",((e,t)=>{let l=t.getTime()-e.getTime(),a=Math.floor(l/1e3/60)%60,o=Math.floor(l/1e3)%60,s=a.toString().padStart(2,"0"),n=o.toString().padStart(2,"0");return"".concat(s,":").concat(n)})(new Date(1e3*x),c)]}),!c&&(0,a.jsx)("p",{className:"text-sm",children:e}),(0,a.jsx)("p",{className:"text-sm text-[#8e8b8f] absolute bottom-4",children:"Playing now on TruckersFM"})]}),b&&(0,a.jsx)("div",{className:"absolute w-full h-full rounded-lg -my-4 -mx-4",style:{backgroundImage:"url(".concat(S(),")"),backgroundSize:"cover",backgroundPosition:"center",filter:"blur(20px) brightness(0.3)"}}),c&&(0,a.jsx)(r,{progress:Math.floor((new Date().getTime()-new Date(1e3*x).getTime())/(c.getTime()-new Date(1e3*x).getTime())*100)})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[625,441,684,358],()=>t(3663)),_N_E=e.O()}]);